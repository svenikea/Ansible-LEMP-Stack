server {
    listen 80 default_server;
    server_name  {{ ServerName }};
    return 301 https://$server_name$request_uri;
}

server {
	listen 443 ssl http2;
	server_name {{ ServerName }};
    root   /var/www/html/{{ Domain }};
	ssl_certificate /etc/nginx/certs/{{ Domain }}/{{ Domain }}_bundle.crt;
	ssl_certificate_key /etc/nginx/certs/{{ Domain }}/{{ Domain }}.key;
    	location / {
        	index  index.php index.html index.htm;
    	}

    	location ~ \.php$ {
        	include fastcgi_params;
    		fastcgi_keep_conn on;
			{% if ansible_distribution == "Ubuntu" %}
        		fastcgi_pass   {{ UbuntuPHPFPM }};
			{% elif ansible_distribution == "Debian" %}
				fastcgi_pass   {{ DebianPHPFPM }};
			{% elif ansible_distribution == "CentOS" %}
				fastcgi_pass   {{ CentOSPHPFPM }};
			{% endif %}

        	fastcgi_index  index.php;
		fastcgi_buffers 8 16k;
		fastcgi_buffer_size 32k;
        	fastcgi_param  SCRIPT_FILENAME  $realpath_root$fastcgi_script_name;
    }
}